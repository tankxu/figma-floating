<style>
  body {
    margin: 0;
  }

  #float-container {
    width: 100%;
    height: 100%;
    overflow: scroll;
    position: relative;
  }
  #corner {
    position: absolute;
    right: 1px;
    bottom: 2px;
    cursor: nwse-resize;
  }
</style>

<div id="float-container">
  <svg
    id="corner"
    width="16"
    height="16"
    viewBox="0 0 16 16"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_200_15)">
      <line
        x1="17.3536"
        y1="1.35355"
        x2="1.35355"
        y2="17.3536"
        stroke="white"
        stroke-opacity="0.7"
      />
      <line
        x1="17.1768"
        y1="1.17678"
        x2="1.17678"
        y2="17.1768"
        stroke="black"
        stroke-opacity="0.5"
        stroke-width="0.5"
      />
      <line
        x1="19.3536"
        y1="4.35355"
        x2="3.35355"
        y2="20.3536"
        stroke="white"
        stroke-opacity="0.5"
      />
      <line
        x1="19.1768"
        y1="4.17678"
        x2="3.17678"
        y2="20.1768"
        stroke="black"
        stroke-opacity="0.4"
        stroke-width="0.5"
      />
    </g>
    <defs>
      <clipPath id="clip0_200_15">
        <rect width="14" height="14" fill="white" />
      </clipPath>
    </defs>
  </svg>
</div>

<script>
  let imageBytes;
  onmessage = (event) => {
    let pluginData = event.data.pluginMessage;
    let imageBytes = pluginData.image;
    let imageWidth = pluginData.width;
    let imageHeight = pluginData.height;
    console.log("got this from the plugin code", imageBytes);

    const floatImage = new Image();

    floatImage.src = URL.createObjectURL(
      new Blob([imageBytes.buffer], { type: "image/png" })
    );

    floatImage.width = imageWidth;

    document.getElementById("float-container").appendChild(floatImage);

    // floatImage.width = floatImage.clientWidth;
  };

  // Resize plugin window
  const corner = document.getElementById("corner");
  function resizeWindow(e) {
    const size = {
      w: Math.max(50, Math.floor(e.clientX + 5)),
      h: Math.max(50, Math.floor(e.clientY + 5)),
    };
    parent.postMessage({ pluginMessage: { type: "resize", size: size } }, "*");
  }
  corner.onpointerdown = (e) => {
    corner.onpointermove = resizeWindow;
    corner.setPointerCapture(e.pointerId);
  };
  corner.onpointerup = (e) => {
    corner.onpointermove = null;
    corner.releasePointerCapture(e.pointerId);
  };
</script>
